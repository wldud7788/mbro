{?!mobileAjaxCall}
	{#common_mypage_myinfo_top}
{/}

{is_file_facebook_tag}
<!--{? empty(sns_f) }-->
<script type="text/javascript">
$(document).ready(function() {
	//facebook 친구들을 쇼핑몰에 초대하기 위해서는 facebook계정으로 쇼핑몰을 이용해 주셔야 합니다.<br>회원정보수정에서 "SNS계정사용"을 수락해 주세요. <br>친구들을 초대하시면 다양한 혜택을 받으실 수 있습니다.<br>지금 회원정보수정 화면으로 이동하시겠습니까?
	openDialogConfirm(getAlert('mp107'),'650','200',function(){document.location.href='../mypage/myinfo'},function(){history.go(-1);});
});
</script>
<!--{ / }-->

<script type="text/javascript">
<!--{? ( strstr(_SERVER.HTTP_HOST,'.firstmall.kr') || _SERVER.HTTP_HOST==APP_DOMAIN ) && empty(fbuser)}-->
$(document).ready(function() {
	//facebook 친구들을 쇼핑몰에 초대하기 위해서는 facebook계정으로 로그인해 주셔야 합니다.<br>지금바로 facebook계정으로 로그인하시겠니까?
	openDialogConfirm(getAlert('mp108'),'650','200',function(){loginwindowopen('facebook','');},function(){history.go(-1);});
});
<!--{ / }-->
function loginjoinwindowopen(sns,stream) {
	var w;var h;
	w = 800;h=400;
	window.open('../member/register_sns_form?popup=1&formtype=myinfojoin&firstmallcartid={firstmallcartid}&snstype='+sns+'&stream='+stream+'&snsreferer={_SERVER.HTTP_HOST}','snspopup','width='+w+'px,height='+h+'px,statusbar=no,scrollbars=no,toolbar=no');
}

function loginwindowopen(sns,stream) {
	var w;var h;
	w = 800;h=400;
	window.open('../member/register_sns_form?popup=1&formtype=login&firstmallcartid={firstmallcartid}&snstype='+sns+'&stream='+stream+'&snsreferer={_SERVER.HTTP_HOST}','snspopup','width='+w+'px,height='+h+'px,statusbar=no,scrollbars=no,toolbar=no');
}
</script>
	<style>
	.myinfo .sectionFacebook {padding:0px;width:100%}
	.myinfo .sectionFacebook .inviteFriends {padding:30px 0px;border-top:1px solid #ffffff;}
	.inviteFriends .boxInfo {padding:0px;border:2px #ceced6;bgcolor: #f8f8f8; }

	.inviteFriends .boxInfo .facebooksearch {overflow:hidden;}

	.inviteFriends .facebooksearch .titleName {float:left;margin-top:10px;letter-spacing:-1px;font-size:11px;color:#000;font-family:dotum;}
	.inviteFriends .facebooksearch .inputName {position:relative;float:left;overflow:hidden;height:30px;width:400px;padding:0 27px 0 0;vertical-align:top;border:1px solid #c6c8e0;left:5px;}
	.inviteFriends .facebooksearch .inputName label {position:absolute;top:0;left:25px;cursor:text;line-height:29px;}
	.inviteFriends .facebooksearch .inputName .text {height:27px;width:300px;;margin:0;padding:0 0 0 25px;line-height:27px;vertical-align:top;border:0;background:transparent;}
	.inviteFriends .facebooksearch .inputName .btnClear {display:block;position:absolute;top:5px;left:324px;overflow:hidden;height:17px;width:17px;text-indent:-1000em;background:url('../images/common/img_fb_close.gif') no-repeat 4px 4px;}
	.inviteFriends .facebooksearch button {display:inline;float:left;overflow:hidden;height:29px;width:63px;margin-left:5px;text-indent:-1000em;vertical-align:top;background:url('../images/common/btn_invite.gif') no-repeat 0 0;}

	.inviteFriends .boxInfo .suggestSearchBox {padding:10px;}
	.inviteFriends .boxInfo .suggestSearch {border:1px solid #CECED6;background-color:#F8F8F8;}
	.inviteFriends .boxInfo .suggestSearch li {padding:10px 20px;}
	.inviteFriends .boxInfo .suggestSearch .checkbox {float:left;margin:18px 18px 0 0;}
	.inviteFriends .boxInfo .suggestSearch .photo {display:inline;float:left;margin-right:10px;}
	.inviteFriends .boxInfo .suggestSearch .friendInfo {overflow:hidden;padding-right:10px;}
	.inviteFriends .boxInfo .suggestSearch .photoValign {display:inline-block;height:50px;vertical-align:middle;}
	.inviteFriends .boxInfo .suggestSearch .friendname {display:inline-block;font-weight:bold;color:#333;line-height:16px;vertical-align:middle;word-break:break-all;}
	.inviteFriends .boxInfo .suggestSearch .friendDim {opacity:0.3;}
		.msie6 .inviteFriends .boxInfo .suggestSearch .friendDim .friendname {color:#BDBDBD;}
		.msie7 .inviteFriends .boxInfo .suggestSearch .friendDim,
		.msie8 .inviteFriends .boxInfo .suggestSearch .friendDim {filter:Alpha(opacity=30)}
	.inviteFriends .boxInfo .suggestSearch .friendDim label {cursor:default;}
	</style>

	<!--{? memberapproval.invitecount>0 && memberapproval.emoneyInvitedCnt>0 }-->
	<div class="pd10">
		<h1 style="padding:2px 0 5px; font-size:16px;color:#000;font-weight:bold;">현재 총 <span style="color:#0049f0;">{=number_format(totalinviteck)}명</span>의 친구를 초대하셨습니다.</h1>

		<div style="letter-spacing:-1px;font-size:12px;font-family:dotum;">
			페이스북 친구 <span style="color:#a60000;font-weight:bold;">{=number_format(memberapproval.invitecount)}명</span>을 초대할 때마다  {user_name}님께 마일리지 <span style="color:#a60000;font-weight:bold;">{=number_format(memberapproval.emoneyInvitedCnt)}원</span>을 드립니다.<br/>
			<div style="font-size:11px;color:#000;">(단, 마일리지은 {=number_format(memberapproval.invitemaxcount)}명초대까지만 혜택 제공/같은 친구를 여러 번 초대해도 1명 초대로 인정)</div>
		</div>
	</div>
	<!--{/}-->
	<!--{? memberapproval.emoneyInvited>0 && memberapproval.emoneyInvitees>0 }-->
	<div class="pd10" style="letter-spacing:-1px;font-size:12px;font-family:dotum;">
		<span style="">초대 받은 페이스북 친구가 회원가입 할 때마다 <br />
		<!--{? (memberapproval.emoneyInvited) > 0 }-->
			 {user_name}님께 마일리지<span style="color:#a60000;font-weight:bold;">{=number_format(memberapproval.emoneyInvited)}원</span>을 드립니다.</span>
		<!--{/}-->
		<!--{? (memberapproval.emoneyInvitees) > 0 }-->
			페이스북 친구에게 마일리지<span style="color:#a60000;font-weight:bold;">{=number_format(memberapproval.emoneyInvitees)}원</span>을 드립니다.</span><br>
		<!--{/}-->
		<div style="font-size:11px;color:#000;">(단, 마일리지은 {memberapproval.emoneyTerm_invited_title} {memberapproval.emoneyLimit_invited}회, 최대 {=number_format(memberapproval.emoneyLimit_invited_title)}원으로 제한)</div>
	</div>
	<!--{/}-->

	<!--{? APP_USE == 'f' && is_file_facebook  }-->
	<div class="sectionFacebook">
		<div class="inviteFriends">
			<div class="boxInfo">
				<div class="facebooksearch"></div>
				<!-- //facebooksearch -->
				<div class="suggestSearchBox">
				<script>
				$(function() {
					$("#findFriend").keyup(function(event){
						if($(this).val().length>0){
							loadFriendList($(this).val());
						} else
							loadFriendList("");
					});

					$("button#fbinvite").click(function(event){
						var arr = $.makeArray($("div.inviteFriends div.suggestSearchBox input[name=friendInfo]:checked"));
						var friendInfo = $.makeArray($("div.inviteFriends div.suggestSearchBox input[name=friendInfo]"));
						var uidArr = new Array();
						while ( aa = arr.pop()) {uidArr.push($(aa).val());}
						var lstr = uidArr.join(",");
						$("#fb_message").focus();
						var message = $("#fb_message").val();
						if(friendInfo.length<1){
							//초대할 친구가 없습니다.
							alert(getAlert('mp187'));
						}else if(!message){
							//초대 메세지를 입력해 주세요!
							alert(getAlert('mp188'));
						}else if(!lstr){
							//초대할 친구를 선택해 주세요!
							alert(getAlert('mp189'));
						}else{
							friendsfeed(lstr, message);
						}
					});
				});
				</script>

				</div>
				<!-- //suggestSearch -->
			</div>
		</div>
	</div>
	<!-- //inviteFriends -->
	<!--{ / }-->



	<script type="text/javascript">
	$(document).ready(function() {
		$("input[name='userid']").blur(function() {
			if($(this).val()){
				$.post("../member_process/id_chk", { userid : $(this).val() }, function(response){
					//debug(response);
					var text = response.return_result;
					var userid = response.userid;
					$("#id_info").html(text);
					$("input[name='userid']").val(userid);
				},'json');
			}
		});

		$('#find_email').change(function() {
			$("input[name='email[1]']").val(this.value);
		});

		if('{mailing}'=='y') $("input:checkbox[name='mailing']").attr('checked','checked');
		if('{sms}'=='y') $("input:checkbox[name='sms']").attr('checked','checked');

		//기존회원 facebook 계정통합 해제하기
		$(".fb-login-button-disconnect").click(function(){
			//정말로 facebook 연결을 해제 하시겠습니까?
			if(confirm(getAlert('mp109'))){
				facebookdisconnect();
			}
		});
		loadFriendList('')
	});

		// 친구리스트
		function loadFriendList(username)
		{
			loadingStart("body",{segments: 12, width: 15.5, space: 6, length: 13, color: '#000000', speed: 1.5});
			var url = '../sns_process/facebooksearchfriends';
			$.getJSON(url + "?jsoncallback=?", function(res) {
				if(res.result == true){
					$("div.inviteFriends div.suggestSearchBox").children().remove();
					$("div.inviteFriends div.suggestSearchBox").append(res.friendstag);
				}else{
					loginwindowopen('facebook',res.publish_stream);
					if(res.publish_stream){
						//loginwindowopen('facebook',res.publish_stream);
					}
				}
			});
			loadingStop("body",true);
		}

		//phpapi feed 보내기
		function friendsfeed(toStr, message) {
			<!--{? ( strstr(_SERVER.HTTP_HOST,'.firstmall.kr') || _SERVER.HTTP_HOST==APP_DOMAIN ) }-->
			loadingStart("body",{segments: 12, width: 15.5, space: 6, length: 13, color: '#000000', speed: 1.5});
			$.ajax({
				'url' : '../sns_process/facebookfeedsend',
				'dataType': 'json',
				'type' : 'post',
				'data' : {'toStr':toStr,'message':message},
				'success': function(res) {
					if(res.result == true){
						openDialogAlert(res.msg,'400','140',function(){document.location.reload();});
					}else{
						loadingStop("body",true);
						openDialogAlert(res.msg,'400','140',function(){});
					}
				}
			});
			<!--{:}-->
			var url = '../sns_process/facebookfeedsend?toStr='+toStr+'&message='+message;
			$.getJSON(url + "&jsoncallback=?", function(res) {
				if(res.result == true){
					openDialogAlert(res.msg,'400','140',function(){document.location.reload();});
				}else{
					if(res.publish_stream){
						loginwindowopen('facebook',res.publish_stream);
					}else{
						openDialogAlert(res.msg,'400','140',function(){});
					}
				}
			});
			<!--{/}-->
		}

		function doClean(){
			$('#findFriend').val('');
			if (fb_link_yn == 'Y') loadFriendList("");
		}

		function filterKey(e) { 
			var keycode;
			var prevent = null; 
			var filter = "[0-9a-z]";
			if(filter){
				// for something else IE
				if (e != null) {
					keycode = e.which;
					prevent = function() {
						e.which = 0;
						e.preventDefault();
					};
				}
				// for IE
				else {
					keycode = window.event.keyCode;
					prevent = function() {
						window.event.keyCode = 0;
						window.event.returnValue = false;
					};
				}

				// fromCharCode : 매개 변수에서 ASCII 값이 나타내는 문자들로 구성된 문자열을 반환합니다
				var sKey = String.fromCharCode(keycode);
				// RegExp
				// 정규표현을 취급하는 객체로 new를 사용하지 않고 정규표현 문자열을 변수에 대입하는 것으로도 동일한 결과
				var re = new RegExp(filter);
				// test() : 일치하는 문자열이 있는 경우 true, 없으면 false
				if(!re.test(sKey)) { 
					prevent();
				}
			}
		}
	</script>
{? !( strstr(_SERVER.HTTP_HOST,'.firstmall.kr') || _SERVER.HTTP_HOST==APP_DOMAIN ) }
<iframe name="snsiframe" src="//{config_system.subDomain}/admin/sns/subdomainfacebookck" frameborder="0" width="0" height="0"></iframe>
{/}
